{% extends 'journal/base_user.html' %}
{% load staticfiles %}
{% load comments %}

{% block 'page-css' %}
<link rel="stylesheet" type="text/css" href="{% static 'journal/entry_form/css/style.css' %}">
{% endblock %}

{% block 'page-js' %}
<script src="{% static 'journal/entry_form/js/main.js' %}"></script>
{% endblock %}

{% block 'nav-content' %}
<div class="activity-description">
  <h3 id="activity"> {{ activity.activity_description}} </h3>
  <div id="dates">
    {{ activity.start_date }} - {{ activity.end_date | default:'Ongoing' }}
  </div>
</div>

<div class="action-bar">
  <a href="/activity/{{ activity.id }}/"> <i class="fa fa-long-arrow-left fa-6x"></i> Back to {{ activity.activity_name }}</a>
</div>
{% endblock %}

{% block 'main-content' %}
<h3> Adding entry for {{ activity.activity_name }}! </h3>
<h4><b>Learning Objectives:</b>
  <ul>
  {% for l in activity.learned_objective.all %}
    <li>{{ l.objective }}</li>
  {% endfor %}
  </ul>
</h4>
<h4> <b>CAS Type:</b>
  <ul>
    {% for i in activity.activity_type.all %}
    <li> {{ i.name }} </li>
    {% endfor %}
  </ul>
</h4>

<h3 id="entry-type"> What is your entry type? </h3>
<ul id="entry-type-selection" class="nav nav-tabs">
  <li role="presentation"><a role="tab" data-toggle="tab" href="#text"> Text </a></li>
  <li role="presentation"><a role="tab" data-toggle="tab" href="#image"> Image </a></li>
  <li role="presentation"><a role="tab" data-toggle="tab" href="#link"> Link </a></li>
</ul>
<br>
{{ form.errors }}
<form name="entry_form" action="" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <div class="tab-content">
    <div id="text" class="tab-pane form-group">
      <textarea class="form-control" rows="10" name="{{ form.text_entry.name }}" value="{{ form.text_entry.value }}">{{ form.text_entry.value|default:'' }}</textarea>
    </div>

    <div id="image" class="tab-pane form-group">
      {% if form.image_entry.value %}
      <img src="/media/{{ form.image_entry.value.name }}">
      {% endif %}
      <input type="file" class="form-control" accept="image/*"
             id="{{ form.image_entry.id }}"
             name="{{ form.image_entry.name }}"
             value="{{ form.image_entry.value }}">
    </div>

    <div id="link" class="tab-pane form-group">
      <input type="url" class="form-control" name="{{ form.link_entry.name }}"
             value="{{ form.link_entry.value|default:'' }}">
    </div>
</div>
    <div class="buttons">
      {% if entry_pk %}
      <a class="btn btn-danger" role="button" href="/delete_entry/{{ activity.id }}/{{ entry_pk }}"> Delete Entry</a>
      {% endif %}
      {% if entry_type %}
      <button class="btn btn-success" type="submit" value="Submit">Submit </button>
      {% endif %}
    </div>
</form>

{% if entry_pk %}
  {% render_comment_list for entry %}
  {% get_comment_form for entry as form %}
    <form action="{% comment_form_target %}" method="POST">
    {% csrf_token %}
    {{ form.honeypot }}
    {{ form.content_type }}
    {{ form.object_pk }}
    {{ form.timestamp }}
    {{ form.security_hash }}
    <textarea class="form-group" id="{{ form.comment.id }}" rows="10" name="{{ form.comment.name }}" value="{{ form.comment.value }}" required></textarea>
    <input type="hidden" name="next" value="{{ request.get_full_path }}/#{{ entry_type }}">
    <br><input class="btn btn-success" type="submit" value="Add comment" id="id_submit">
    </form>
{% endif %}

{% endblock %}
